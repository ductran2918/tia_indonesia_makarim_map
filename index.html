<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Network Graphic</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body, html { 
        margin: 0; 
        padding: 0;
        height: 100%; 
        overflow: hidden; /* Prevent scrollbars */
        background: transparent;
    }
    
    svg { 
        display: block; 
        width: 100vw;  /* Use viewport width */
        height: 100vh; /* Use viewport height */
        max-width: 100%;
        max-height: 100%;
        background: transparent;
    }
    
    .group-circle {
      fill: none;
      stroke: #999;
      stroke-width: 1.5px;
      stroke-dasharray: 5,5;
    }
    .node-image {
      clip-path: circle(30px at center);
    }
    .node-border {
      fill: none;
      stroke-width: 15px;
    }
    text {
      font-family: sans-serif;
      font-size: 12px;
      text-anchor: middle;
      pointer-events: none;
    }
    .tooltip {
      position: absolute;
        padding: 6px 10px;
        background: rgba(0,0,0,0.7);
        color: #fff;
        border-radius: 4px;
        font-size: 14px;         
        font-family: sans-serif;    
        font-weight: normal;       
        font-style: normal;      
        pointer-events: none;
        visibility: hidden;
        max-width: 200px;        /* Set maximum width */
        white-space: normal;     /* Allow text wrapping */
        word-wrap: break-word;   /* Break long words if needed */
        line-height: 1.4;        /* Add some spacing between lines */
    }
    .circle-header {
        font-family: sans-serif;
        font-size: 14px;
        font-weight: bold;
        text-anchor: middle;
        pointer-events: none;
    }
    .legend text {
        text-anchor: start;  /* Align text to left */
    }
    .legend-circle {
        fill: none;
        stroke-width: 8px;  /* This controls the border thickness */
    }
    .chart-title {
      font-family: sans-serif;
      font-size: 18px;
      font-weight: bold;
      text-anchor: middle;
    }
    .chart-subtitle {
      font-family: sans-serif;
      font-size: 16px;
      font-weight: normal;
      text-anchor: middle;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
        .circle-header {
            font-size: 12px;  /* Smaller text on mobile */
        }
        
        text {
            font-size: 10px;  /* Smaller node text on mobile */
        }
        
        .tooltip {
            font-size: 12px;  /* Smaller tooltip text */
            max-width: 150px; /* Narrower tooltips on mobile */
        }
    }
    
    @media (max-width: 480px) {
        .circle-header {
            font-size: 10px;  /* Even smaller on very small screens */
        }
        
        text {
            font-size: 9px;
        }
    }
  </style>
<!-- Add this in the head section of your HTML file -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  /* Add responsive CSS */
  .visualization-container {
    width: 100%;
    max-width: 100%;
    overflow: hidden;
    position: relative;
  }
  
  /* Make SVG responsive */
  svg {
    width: 100%;
    height: auto;
    display: block;
  }
  
  /* Adjust text for mobile */
  @media screen and (max-width: 767px) {
    .node text, .label text {
      font-size: 12px; /* smaller font for mobile */
    }
    
    /* This scales the entire visualization */
    svg {
      transform-origin: center center;
      transform: scale(0.85);
    }
    
    /* Adjust positioning for mobile */
    .right-side-nodes {
      transform: translateX(-20px); /* move Google Indonesia node left on mobile */
    }
    
    /* Update hover instruction for touch devices */
    .hover-instruction {
      content: "Tap nodes to see more details";
    }
  }
</style>
</head>
<body>

<div class="tooltip" id="tooltip"></div>
<script>
(async function() {
  let svg, data, node, legend;
  
  // Function to get responsive dimensions
  function getResponsiveDimensions() {
    const width = window.innerWidth;
    const height = window.innerHeight;
    const isMobile = width < 768;
    const isSmallMobile = width < 480;
    
    return {
      width,
      height,
      isMobile,
      isSmallMobile,
      centerX: width / 2,
      centerY: height / 2,
      buyerR: isMobile ? Math.min(width * 0.35, 180) : Math.min(width * 0.25, 250),
      specialR: isMobile ? Math.min(width * 0.25, 130) : Math.min(width * 0.18, 180),
      gojekR: isMobile ? Math.min(width * 0.15, 80) : Math.min(width * 0.11, 110)
    };
  }
  
  // Function to get node positions based on current dimensions
  function getNodePositions(dims) {
    const buyerCenter = { x: dims.centerX, y: dims.centerY };
    const specialCenter = { x: dims.centerX - (dims.isMobile ? 35 : 55), y: dims.centerY - 10 };
    const gojekCenter = { x: dims.centerX - (dims.isMobile ? 80 : 120), y: dims.centerY - 10 };
    
    return {
      buyerCenter,
      specialCenter,
      gojekCenter,
      positions: {
        "Jurist Tan": { x: gojekCenter.x + (dims.isMobile ? 25 : 40), y: gojekCenter.y + (dims.isMobile ? 20 : 30) },
        "Nadiem Makarim": { x: gojekCenter.x - (dims.isMobile ? 25 : 40), y: gojekCenter.y - (dims.isMobile ? 35 : 50) },
        "Ibrahim Arief": { x: specialCenter.x + (dims.isMobile ? 60 : 95), y: specialCenter.y + (dims.isMobile ? 40 : 60) },
        "Fiona Handayani": { x: specialCenter.x + (dims.isMobile ? 60 : 100), y: specialCenter.y - (dims.isMobile ? 45 : 70) },
        "Mulyatsyah": { x: buyerCenter.x + (dims.isMobile ? 100 : 160), y: buyerCenter.y + (dims.isMobile ? 60 : 90) },
        "Sri Wahyuningsih": { x: buyerCenter.x + (dims.isMobile ? 110 : 180), y: buyerCenter.y - (dims.isMobile ? 45 : 70) },
        "Ganis Samoedra": { x: buyerCenter.x + (dims.isMobile ? 200 : 350), y: buyerCenter.y }
      }
    };
  }
  
  // Function to create/update the entire visualization
  function createVisualization() {
    const dims = getResponsiveDimensions();
    const nodePositions = getNodePositions(dims);
    
    // Clear existing SVG
    d3.select("body").select("svg").remove();
    
    // Create new SVG
    svg = d3.select("body")
        .append("svg")
        .attr("viewBox", [0, 0, dims.width, dims.height])
        .attr("preserveAspectRatio", "xMidYMid meet")
        .style("width", "100%")
        .style("height", "100%");

    // Draw circles
    drawCircles(dims, nodePositions);
    
    // Draw nodes if data is available
    if (data) {
      drawNodes(dims, nodePositions);
    }
    
    // Draw legend
    drawLegend(dims, nodePositions.buyerCenter);
  }
  
  function drawCircles(dims, nodePositions) {
    const { buyerCenter, specialCenter, gojekCenter } = nodePositions;
    
    // Buyer circle
    svg.append("circle")
        .attr("class", "group-circle")
        .attr("cx", buyerCenter.x)
        .attr("cy", buyerCenter.y)
        .attr("r", dims.buyerR)
        .style("stroke-dasharray", "5,5");
        
    // Government text
    const buyerText = svg.append("text")
        .attr("class", "circle-header")
        .attr("x", buyerCenter.x)
        .attr("y", buyerCenter.y - dims.buyerR + (dims.isMobile ? 20 : 30))
        .attr("text-anchor", "middle");

    buyerText.append("tspan")
        .attr("x", buyerCenter.x)
        .attr("dy", "0")
        .text("Indonesian Ministry");

    buyerText.append("tspan")
        .attr("x", buyerCenter.x)
        .attr("dy", "1.2em")
        .text("of Education and Culture");

    // Special team circle
    svg.append("circle")
        .attr("class", "group-circle")
        .attr("cx", specialCenter.x)
        .attr("cy", specialCenter.y)
        .attr("r", dims.specialR)
        .style("stroke-dasharray", "5,5");
        
    svg.append("text")
        .attr("class", "circle-header")
        .attr("x", specialCenter.x - 5)
        .attr("y", specialCenter.y - dims.specialR + (dims.isMobile ? 30 : 45))
        .text("Special staff");

    // Gojek circle
    svg.append("circle")
        .attr("class", "group-circle")
        .attr("cx", gojekCenter.x)
        .attr("cy", gojekCenter.y)
        .attr("r", dims.gojekR)
        .style("stroke-dasharray", "5,5");
        
    svg.append("text")
        .attr("class", "circle-header")
        .attr("x", gojekCenter.x + (dims.isMobile ? 30 : 50))
        .attr("y", gojekCenter.y - dims.gojekR + (dims.isMobile ? 40 : 60))
        .text("Ex-Gojek");

    // Google Indonesia text
    svg.append("text")
        .attr("class", "circle-header")
        .attr("x", nodePositions.positions["Ganis Samoedra"].x)
        .attr("y", nodePositions.positions["Ganis Samoedra"].y - 50)
        .text("Google Indonesia");

    // Title and subtitle
    svg.append("text")
        .attr("class", "chart-title")
        .attr("x", buyerCenter.x)
        .attr("y", buyerCenter.y - dims.buyerR - (dims.isMobile ? 80 : 120))
        .attr("text-anchor", "middle")
        .style("font-family", "sans-serif")
        .style("font-size", dims.isMobile ? "16px" : "22px")
        .style("font-weight", "bold")
        .text("Key people involved in laptop procurement case");

    svg.append("text")
        .attr("class", "chart-subtitle")
        .attr("x", buyerCenter.x)
        .attr("y", buyerCenter.y - dims.buyerR - (dims.isMobile ? 60 : 95))
        .attr("text-anchor", "middle")
        .style("font-family", "sans-serif")
        .style("font-size", dims.isMobile ? "12px" : "16px")
        .style("font-weight", "normal")
        .text("Hover over nodes to see more details");
  }
  

  
  function drawNodes(dims, nodePositions) {
    const tooltip = d3.select("#tooltip");
    const imageSize = dims.isMobile ? 30 : 60;
    const imageRadius = imageSize / 2;
    
    node = svg.selectAll("g.node")
      .data(data)
      .enter()
      .append("g")
        .attr("class", "node")
        .attr("transform", d => {
          const pos = nodePositions.positions[d.person] || { x: dims.centerX, y: dims.centerY };
          return `translate(${pos.x},${pos.y})`;
        })
        .on("mouseover", (e,d) => {
          tooltip.style("visibility", "visible").text(d.title);
        })
        .on("mousemove", (e) => {
          tooltip.style("top", (e.pageY + 10) + "px")
                 .style("left", (e.pageX + 10) + "px");
        })
        .on("mouseout", () => {
          tooltip.style("visibility", "hidden");
        });

    node.append("circle")
        .attr("class", "node-border")
        .attr("r", dims.isMobile ? 20 : 30)
        .attr("stroke", d => d.borderColor);

    node.append("image")
        .attr("class", "node-image")
        .attr("xlink:href", d => d.image)
        .attr("x", -imageRadius)
        .attr("y", -imageRadius)
        .attr("width", imageSize)
        .attr("height", imageSize);

    node.append("text")
        .attr("dy", dims.isMobile ? 35 : 48)
        .text(d => d.person)
        .style("font-size", dims.isMobile ? "8px" : "12px");

    // Add "Minister" subtitle for Nadiem Makarim
    node.filter(d => d.person === "Nadiem Makarim")
        .append("text")
        .attr("dy", dims.isMobile ? 45 : 62)
        .text("Minister")
        .style("font-size", dims.isMobile ? "6px" : "10px")
        .style("fill", "#666");
  }
  
  function drawLegend(dims, buyerCenter) {
    legend = svg.append("g")
        .attr("class", "legend")
        .attr("transform", `translate(${buyerCenter.x - (dims.isMobile ? 60 : 100)}, ${buyerCenter.y - dims.buyerR - (dims.isMobile ? 40 : 60)})`);

    const legendData = [
        { status: "Witness", color: "steelblue" },
        { status: "Suspect", color: "#de544a" }
    ];

    legend.selectAll("circle")
        .data(legendData)
        .enter()
        .append("circle")
        .attr("cx", (d, i) => i * (dims.isMobile ? 80 : 120))
        .attr("cy", 0)
        .attr("r", dims.isMobile ? 10 : 15)
        .attr("stroke", d => d.color)
        .attr("class", "legend-circle")
        .attr("fill", "none");

    legend.selectAll("text")
        .data(legendData)
        .enter()
        .append("text")
        .attr("x", (d, i) => i * (dims.isMobile ? 80 : 120) + (dims.isMobile ? 15 : 25))
        .attr("y", 0)
        .attr("dy", "0.3em")
        .text(d => d.status)
        .style("font-family", "sans-serif")
        .style("font-size", dims.isMobile ? "8px" : "12px");
  }
    // Responsive function to adjust visualization based on screen size
    function makeResponsive() {
    // Get the dimensions of the viewport
    const viewportWidth = window.innerWidth;
    
    // Adjust visualization based on screen size
    if (viewportWidth <= 767) {
        // For mobile
        // Check if you're using D3 force simulation
        if (typeof simulation !== 'undefined') {
        simulation.force("center", d3.forceCenter(width/2, height/2))
            .force("x", d3.forceX().strength(0.1).x(function(d) {
            // Adjust x positions to be closer to center on mobile
            return width/2 + (d.x - width/2) * 0.8;
            }))
            .force("y", d3.forceY().strength(0.1).y(function(d) {
            return height/2 + (d.y - height/2) * 0.8;
            }))
            .alpha(0.3).restart();
        }
        
        // Update text to "tap" instead of "hover" for mobile
        let instructionText = document.querySelector(".instructions-text") || 
                            document.querySelector("text:contains('Hover over nodes')");
        if (instructionText) {
        instructionText.textContent = "Tap nodes to see more details";
        }
    }
    }

// Call this function on load and window resize
window.addEventListener('load', makeResponsive);
window.addEventListener('resize', makeResponsive);
  // — 4. Load your CSV
  data = await d3.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vRtgiSI8nDz2DcCgy2jgWWgDCR-DCgF8PMo0mDzKG28DZTJv9b4S_eFKWQFfSTNms9nlsn7nEGnBLZq/pub?gid=0&single=true&output=csv");
  console.log("Loaded data:", data);

  // — 5. Process data
  data.forEach(d => {
    const dims = getResponsiveDimensions();
    if (d.buyer.toLowerCase() === 'y') {
      d.grp = "buyer";
      d.rTarget = dims.buyerR * 0.8;
    } else {
      d.grp = "none";
      d.rTarget = dims.buyerR + 100;
    }
    if (d.special_staff.toLowerCase() === 'y') {
      d.grp = "special";
      d.rTarget = dims.specialR * 0.6;
    }
    if (d.gojek.toLowerCase() === 'y') {
      d.grp = "gojek";
      d.rTarget = dims.gojekR * 0.5;
    }
    d.borderColor = d.Status === "Suspect" ? "#de544a" : "steelblue";
  });

  // Initial visualization
  createVisualization();

  // Add window resize listener with debouncing
  let resizeTimeout;
  window.addEventListener('resize', () => {
    clearTimeout(resizeTimeout);
    resizeTimeout = setTimeout(() => {
      createVisualization();
    }, 150); // Debounce resize events
  });
})();
</script>
</body>
</html>
