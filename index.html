<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Network Graphic - Smart Responsive</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    * {
      box-sizing: border-box;
    }
    
    body, html { 
        margin: 0; 
        padding: 0;
        background: transparent;
        font-family: sans-serif;
    }
    
    .visualization-container {
      width: 100%;
      background: transparent;
      position: relative;
    }
    
    svg { 
        display: block; 
        width: 100%;
        background: transparent;
    }
    
    .group-circle {
      fill: none;
      stroke: #999;
      stroke-dasharray: 5,5;
    }
    .node-image {
      clip-path: circle(30px at center);
    }
    .node-border {
      fill: none;
      stroke-width: 15px;
    }
    text {
      font-family: sans-serif;
      font-size: 12px;
      text-anchor: middle;
      pointer-events: none;
    }
    .tooltip {
      position: absolute;
      padding: 6px 10px;
      background: rgba(0,0,0,0.7);
      color: #fff;
      border-radius: 4px;
      font-size: 14px;         
      font-family: sans-serif;    
      font-weight: normal;       
      pointer-events: none;
      visibility: hidden;
      max-width: 200px;
      white-space: normal;
      word-wrap: break-word;
      line-height: 1.4;
      z-index: 1000;
    }
    .circle-header {
        font-family: sans-serif;
        font-size: 14px;
        font-weight: bold;
        text-anchor: middle;
        pointer-events: none;
    }
    .legend text {
        text-anchor: start;
    }
    .legend-circle {
        fill: none;
        stroke-width: 8px;
    }
    .chart-title {
      font-family: sans-serif;
      font-size: 18px;
      font-weight: bold;
      text-anchor: middle;
    }
    .chart-subtitle {
      font-family: sans-serif;
      font-size: 16px;
      font-weight: normal;
      text-anchor: middle;
    }

    /* Mobile-specific styles */
    @media (max-width: 768px) {
      .group-circle {
        stroke-width: 1px;
        stroke-dasharray: 3,3;
      }
      .node-image {
        clip-path: circle(15px at center);
      }
      .node-border {
        stroke-width: 8px;
      }
      text {
        font-size: 8px;
      }
      .tooltip {
        padding: 4px 6px;
        font-size: 11px;
        max-width: 120px;
        line-height: 1.3;
      }
      .circle-header {
        font-size: 9px;
      }
      .legend text {
        font-size: 8px;
      }
      .legend-circle {
        stroke-width: 4px;
      }
      .chart-title {
        font-size: 13px;
      }
      .chart-subtitle {
        font-size: 10px;
      }
    }
  </style>
</head>
<body>

<div class="visualization-container">
  <div class="tooltip" id="tooltip"></div>
</div>

<script>
(async function() {
  let svg, data, node, legend;
  
  // Detect if device is mobile
  function isMobileDevice() {
    return window.innerWidth <= 768 || /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
  }
  
  // Get responsive dimensions based on device type
  function getResponsiveDimensions() {
    const width = window.innerWidth;
    const isMobile = isMobileDevice();
    
    if (isMobile) {
      // Mobile: taller aspect ratio, smaller elements
      const height = Math.max(600, width * 1.3);
      return {
        width,
        height,
        isMobile: true,
        centerX: width / 2,
        centerY: height / 2,
        mainR: Math.min(width * 0.35, 140),
        specialR: Math.min(width * 0.22, 85),
        gojekR: Math.min(width * 0.15, 55)
      };
    } else {
      // Desktop: wider aspect ratio, larger elements
      const height = Math.max(600, width * 0.6);
      return {
        width,
        height,
        isMobile: false,
        centerX: width / 2,
        centerY: height / 2,
        buyerR: Math.min(width * 0.25, 250),
        specialR: Math.min(width * 0.18, 180),
        gojekR: Math.min(width * 0.11, 110)
      };
    }
  }
  
  // Get node positions based on device type
  function getNodePositions(dims) {
    if (dims.isMobile) {
      // Mobile: vertical stacking layout with better spacing
      const { centerX, centerY, mainR, specialR, gojekR } = dims;
      
      const ministryCenter = { x: centerX, y: centerY - 80 };
      const specialCenter = { x: centerX - 60, y: centerY + 10 };
      const gojekCenter = { x: centerX + 60, y: centerY + 10 };
      const googleCenter = { x: centerX, y: centerY + 140 };
      
      return {
        ministryCenter,
        specialCenter,
        gojekCenter,
        googleCenter,
        positions: {
          // Ministry people at top - spread them out more
          "Sri Wahyuningsih": { x: ministryCenter.x - 65, y: ministryCenter.y - 25 },
          "Mulyatsyah": { x: ministryCenter.x + 65, y: ministryCenter.y - 25 },
          
          // Special staff people - better vertical spacing  
          "Fiona Handayani": { x: specialCenter.x - 30, y: specialCenter.y - 40 },
          "Ibrahim Arief": { x: specialCenter.x + 30, y: specialCenter.y + 40 },
          
          // Ex-Gojek people - better spacing
          "Nadiem Makarim": { x: gojekCenter.x - 30, y: gojekCenter.y - 40 },
          "Jurist Tan": { x: gojekCenter.x + 30, y: gojekCenter.y + 40 },
          
          // Google at bottom
          "Ganis Samoedra": { x: googleCenter.x, y: googleCenter.y }
        }
      };
    } else {
      // Desktop: horizontal overlapping layout
      const { centerX, centerY, buyerR, specialR, gojekR } = dims;
      
      const buyerCenter = { x: centerX, y: centerY };
      const specialCenter = { x: centerX - 55, y: centerY - 10 };
      const gojekCenter = { x: centerX - 120, y: centerY - 10 };
      
      return {
        buyerCenter,
        specialCenter,
        gojekCenter,
        positions: {
          "Jurist Tan": { x: gojekCenter.x + 40, y: gojekCenter.y + 30 },
          "Nadiem Makarim": { x: gojekCenter.x - 40, y: gojekCenter.y - 50 },
          "Ibrahim Arief": { x: specialCenter.x + 95, y: specialCenter.y + 60 },
          "Fiona Handayani": { x: specialCenter.x + 100, y: specialCenter.y - 70 },
          "Mulyatsyah": { x: buyerCenter.x + 160, y: buyerCenter.y + 90 },
          "Sri Wahyuningsih": { x: buyerCenter.x + 180, y: buyerCenter.y - 70 },
          "Ganis Samoedra": { x: buyerCenter.x + 350, y: buyerCenter.y }
        }
      };
    }
  }
  
  // Create visualization based on device type
  function createVisualization() {
    const dims = getResponsiveDimensions();
    const nodePositions = getNodePositions(dims);
    
    // Clear existing SVG
    d3.select(".visualization-container").select("svg").remove();
    
    // Create new SVG
    svg = d3.select(".visualization-container")
        .append("svg")
        .attr("viewBox", [0, 0, dims.width, dims.height])
        .attr("preserveAspectRatio", "xMidYMid meet")
        .attr("width", dims.width)
        .attr("height", dims.height)
        .style("width", "100%")
        .style("height", "auto");

    // Draw circles based on device type
    if (dims.isMobile) {
      drawMobileCircles(dims, nodePositions);
    } else {
      drawDesktopCircles(dims, nodePositions);
    }
    
    // Draw nodes if data is available
    if (data) {
      drawNodes(dims, nodePositions);
    }
    
    // Draw legend
    drawLegend(dims, nodePositions);
  }
  
  function drawMobileCircles(dims, nodePositions) {
    const { ministryCenter, specialCenter, gojekCenter, googleCenter } = nodePositions;
    
    // Main Ministry circle
    svg.append("circle")
        .attr("class", "group-circle")
        .attr("cx", ministryCenter.x)
        .attr("cy", ministryCenter.y)
        .attr("r", dims.mainR);
        
    const ministryText = svg.append("text")
        .attr("class", "circle-header")
        .attr("x", ministryCenter.x)
        .attr("y", ministryCenter.y - dims.mainR + 15);

    ministryText.append("tspan")
        .attr("x", ministryCenter.x)
        .attr("dy", "0")
        .text("Indonesian Ministry");

    ministryText.append("tspan")
        .attr("x", ministryCenter.x)
        .attr("dy", "1.2em")
        .text("of Education and Culture");

    // Special staff circle
    svg.append("circle")
        .attr("class", "group-circle")
        .attr("cx", specialCenter.x)
        .attr("cy", specialCenter.y)
        .attr("r", dims.specialR);
        
    svg.append("text")
        .attr("class", "circle-header")
        .attr("x", specialCenter.x)
        .attr("y", specialCenter.y - dims.specialR + 15)
        .text("Special staff");

    // Ex-Gojek circle
    svg.append("circle")
        .attr("class", "group-circle")
        .attr("cx", gojekCenter.x)
        .attr("cy", gojekCenter.y)
        .attr("r", dims.gojekR);
        
    svg.append("text")
        .attr("class", "circle-header")
        .attr("x", gojekCenter.x)
        .attr("y", gojekCenter.y - dims.gojekR + 15)
        .text("Ex-Gojek");

    // Google Indonesia text
    svg.append("text")
        .attr("class", "circle-header")
        .attr("x", googleCenter.x)
        .attr("y", googleCenter.y - 25)
        .text("Google Indonesia");

    // Title and subtitle
    svg.append("text")
        .attr("class", "chart-title")
        .attr("x", dims.centerX)
        .attr("y", 25)
        .text("Key people involved in laptop procurement case");

    svg.append("text")
        .attr("class", "chart-subtitle")
        .attr("x", dims.centerX)
        .attr("y", 40)
        .text("Tap nodes for details");
  }
  
  function drawDesktopCircles(dims, nodePositions) {
    const { buyerCenter, specialCenter, gojekCenter } = nodePositions;
    
    // Buyer circle
    svg.append("circle")
        .attr("class", "group-circle")
        .attr("cx", buyerCenter.x)
        .attr("cy", buyerCenter.y)
        .attr("r", dims.buyerR);
        
    const buyerText = svg.append("text")
        .attr("class", "circle-header")
        .attr("x", buyerCenter.x)
        .attr("y", buyerCenter.y - dims.buyerR + 30);

    buyerText.append("tspan")
        .attr("x", buyerCenter.x)
        .attr("dy", "0")
        .text("Indonesian Ministry");

    buyerText.append("tspan")
        .attr("x", buyerCenter.x)
        .attr("dy", "1.2em")
        .text("of Education and Culture");

    // Special team circle
    svg.append("circle")
        .attr("class", "group-circle")
        .attr("cx", specialCenter.x)
        .attr("cy", specialCenter.y)
        .attr("r", dims.specialR);
        
    svg.append("text")
        .attr("class", "circle-header")
        .attr("x", specialCenter.x - 5)
        .attr("y", specialCenter.y - dims.specialR + 45)
        .text("Special staff");

    // Gojek circle
    svg.append("circle")
        .attr("class", "group-circle")
        .attr("cx", gojekCenter.x)
        .attr("cy", gojekCenter.y)
        .attr("r", dims.gojekR);
        
    svg.append("text")
        .attr("class", "circle-header")
        .attr("x", gojekCenter.x + 50)
        .attr("y", gojekCenter.y - dims.gojekR + 60)
        .text("Ex-Gojek");

    // Google Indonesia text
    svg.append("text")
        .attr("class", "circle-header")
        .attr("x", nodePositions.positions["Ganis Samoedra"].x)
        .attr("y", nodePositions.positions["Ganis Samoedra"].y - 50)
        .text("Google Indonesia");

    // Title and subtitle
    svg.append("text")
        .attr("class", "chart-title")
        .attr("x", buyerCenter.x)
        .attr("y", buyerCenter.y - dims.buyerR - 120)
        .text("Key people involved in laptop procurement case");

    svg.append("text")
        .attr("class", "chart-subtitle")
        .attr("x", buyerCenter.x)
        .attr("y", buyerCenter.y - dims.buyerR - 95)
        .text("Hover over nodes to see more details");
  }
  
  function drawNodes(dims, nodePositions) {
    const tooltip = d3.select("#tooltip");
    const imageSize = dims.isMobile ? 24 : 60;
    const imageRadius = imageSize / 2;
    const borderRadius = dims.isMobile ? 15 : 30;
    
    node = svg.selectAll("g.node")
      .data(data)
      .enter()
      .append("g")
        .attr("class", "node")
        .attr("transform", d => {
          const pos = nodePositions.positions[d.person] || { x: dims.centerX, y: dims.centerY };
          return `translate(${pos.x},${pos.y})`;
        });

    // Add touch events for mobile, mouse events for desktop
    if (dims.isMobile) {
      node.on("touchstart", (e,d) => {
          e.preventDefault();
          tooltip.style("visibility", "visible").text(d.title);
          const touch = e.touches[0];
          tooltip.style("top", (touch.pageY + 10) + "px")
                 .style("left", (touch.pageX + 10) + "px");
        })
        .on("touchend", () => {
          setTimeout(() => {
            tooltip.style("visibility", "hidden");
          }, 2000);
        });
    } else {
      node.on("mouseover", (e,d) => {
          tooltip.style("visibility", "visible").text(d.title);
        })
        .on("mousemove", (e) => {
          tooltip.style("top", (e.pageY + 10) + "px")
                 .style("left", (e.pageX + 10) + "px");
        })
        .on("mouseout", () => {
          tooltip.style("visibility", "hidden");
        });
    }

    node.append("circle")
        .attr("class", "node-border")
        .attr("r", borderRadius)
        .attr("stroke", d => d.borderColor);

    node.append("image")
        .attr("class", "node-image")
        .attr("xlink:href", d => d.image)
        .attr("x", -imageRadius)
        .attr("y", -imageRadius)
        .attr("width", imageSize)
        .attr("height", imageSize);

    node.append("text")
        .attr("dy", dims.isMobile ? 25 : 48)
        .text(d => d.person)
        .style("font-size", dims.isMobile ? "8px" : "12px");

    // Add "Minister" subtitle for Nadiem Makarim
    node.filter(d => d.person === "Nadiem Makarim")
        .append("text")
        .attr("dy", dims.isMobile ? 33 : 62)
        .text("Minister")
        .style("font-size", dims.isMobile ? "6px" : "10px")
        .style("fill", "#666");
  }
  
  function drawLegend(dims, nodePositions) {
    const legendX = dims.isMobile ? dims.centerX - 40 : (nodePositions.buyerCenter?.x - 100 || dims.centerX - 100);
    const legendY = dims.isMobile ? 55 : (nodePositions.buyerCenter?.y - dims.buyerR - 60 || 55);
    
    legend = svg.append("g")
        .attr("class", "legend")
        .attr("transform", `translate(${legendX}, ${legendY})`);

    const legendData = [
        { status: "Witness", color: "steelblue" },
        { status: "Suspect", color: "#de544a" }
    ];

    const spacing = dims.isMobile ? 50 : 120;
    const circleRadius = dims.isMobile ? 6 : 15;
    const textOffset = dims.isMobile ? 10 : 25;

    legend.selectAll("circle")
        .data(legendData)
        .enter()
        .append("circle")
        .attr("cx", (d, i) => i * spacing)
        .attr("cy", 0)
        .attr("r", circleRadius)
        .attr("stroke", d => d.color)
        .attr("class", "legend-circle")
        .attr("fill", "none");

    legend.selectAll("text")
        .data(legendData)
        .enter()
        .append("text")
        .attr("x", (d, i) => i * spacing + textOffset)
        .attr("y", 0)
        .attr("dy", "0.3em")
        .text(d => d.status)
        .style("font-size", dims.isMobile ? "7px" : "12px");
  }

  // Load CSV data
  data = await d3.csv("https://docs.google.com/spreadsheets/d/e/2PACX-1vRtgiSI8nDz2DcCgy2jgWWgDCR-DCgF8PMo0mDzKG28DZTJv9b4S_eFKWQFfSTNms9nlsn7nEGnBLZq/pub?gid=0&single=true&output=csv");

  // Process data
  data.forEach(d => {
    d.borderColor = d.Status === "Suspect" ? "#de544a" : "steelblue";
  });

  // Initial visualization
  createVisualization();

  // Add window resize listener with debouncing
  let resizeTimeout;
  window.addEventListener('resize', () => {
    clearTimeout(resizeTimeout);
    resizeTimeout = setTimeout(() => {
      createVisualization();
    }, 150);
  });
})();
</script>
</body>
</html>
